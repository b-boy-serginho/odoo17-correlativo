<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extender la vista de árbol (list) de stock.move para agregar el campo Costo -->
    <record id="view_stock_move_tree_inherit_cardex" model="ir.ui.view">
        <field name="name">stock.move.tree.inherit.cardex</field>
        <field name="model">stock.move</field>
        <field name="inherit_id" ref="stock.view_move_tree"/>
        <field name="arch" type="xml">
            
            <!-- Agregar el campo Costo después de la columna Producto -->
            <xpath expr="//field[@name='product_id']" position="after">
                <field name="product_cost" string="Costo Unit." 
                       widget="monetary" 
                       options="{'currency_field': 'company_currency_id'}"
                       optional="show"/>
                <field name="total_cost" string="Costo Total" 
                       widget="monetary" 
                       options="{'currency_field': 'company_currency_id'}"
                       optional="hide"/>
                <field name="company_currency_id" invisible="1"/>
            </xpath>
            
        </field>
    </record>

    <!-- Extender TAMBIÉN la vista de reportes (stock.move.tree2) -->
    <record id="view_stock_move_tree2_inherit_cardex" model="ir.ui.view">
        <field name="name">stock.move.tree2.inherit.cardex</field>
        <field name="model">stock.move</field>
        <field name="inherit_id" ref="stock.view_move_tree_receipt_picking"/>
        <field name="arch" type="xml">
            
            <!-- Agregar el campo Costo después de la columna Producto -->
            <xpath expr="//field[@name='product_id']" position="after">
                <field name="product_cost" string="Costo" 
                       widget="monetary" 
                       options="{'currency_field': 'company_currency_id'}"
                       optional="show"/>
                <field name="total_cost" string="Costo Total" 
                       widget="monetary" 
                       options="{'currency_field': 'company_currency_id'}"
                       optional="hide"/>
                <field name="company_currency_id" invisible="1"/>
            </xpath>
            
        </field>
    </record>


    <!-- Extender la vista de picking moves -->
    <record id="view_stock_picking_move_tree_inherit_cardex" model="ir.ui.view">
        <field name="name">stock.picking.move.tree.inherit.cardex</field>
        <field name="model">stock.move</field>
        <field name="inherit_id" ref="stock.view_picking_move_tree"/>
        <field name="arch" type="xml">
            
            <!-- Agregar el campo Costo después de la columna Producto -->
            <xpath expr="//field[@name='product_id']" position="after">
                <field name="product_cost" string="Costo" 
                       widget="monetary" 
                       options="{'currency_field': 'company_currency_id'}"
                       optional="show"/>
                <field name="total_cost" string="Costo Total" 
                       widget="monetary" 
                       options="{'currency_field': 'company_currency_id'}"
                       optional="hide"/>
                <field name="company_currency_id" invisible="1"/>
            </xpath>
            
        </field>
    </record>

    <!-- Extender la vista de formulario de stock.move para mostrar información de costo -->
    <record id="view_stock_move_form_inherit_cardex" model="ir.ui.view">
        <field name="name">stock.move.form.inherit.cardex</field>
        <field name="model">stock.move</field>
        <field name="inherit_id" ref="stock.view_move_form"/>
        <field name="arch" type="xml">
            
            <!-- Agregar información de costo en el formulario -->
            <xpath expr="//field[@name='product_uom_qty']" position="after">
                <field name="product_cost" string="Costo Unitario" 
                       widget="monetary"
                       options="{'currency_field': 'company_currency_id'}"/>
                <field name="total_cost" string="Costo Total del Movimiento" 
                       widget="monetary"
                       options="{'currency_field': 'company_currency_id'}"/>
                <field name="company_currency_id" invisible="1"/>
            </xpath>
            
        </field>
    </record>

    <!-- Extender la vista de líneas de movimiento (stock.move.line) -->
    <record id="view_stock_move_line_tree_inherit_cardex" model="ir.ui.view">
        <field name="name">stock.move.line.tree.inherit.cardex</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_stock_move_line_operation_tree"/>
        <field name="arch" type="xml">
            
            <!-- Agregar costo en las líneas de movimiento -->
            <xpath expr="//field[@name='product_id']" position="after">
                <field name="product_cost" string="Costo" 
                       widget="monetary"
                       options="{'currency_field': 'company_currency_id'}"
                       optional="show"/>
                <field name="line_cost" string="Costo Total" 
                       widget="monetary"
                       options="{'currency_field': 'company_currency_id'}"
                       optional="hide"/>
                <field name="company_currency_id" invisible="1"/>
            </xpath>
            
        </field>
    </record>

    <!-- Vista de búsqueda mejorada con filtro por costo -->
    <record id="view_stock_move_search_inherit_cardex" model="ir.ui.view">
        <field name="name">stock.move.search.inherit.cardex</field>
        <field name="model">stock.move</field>
        <field name="inherit_id" ref="stock.view_move_search"/>
        <field name="arch" type="xml">
            
            <!-- Agregar filtros de búsqueda por costo -->
            <xpath expr="//search" position="inside">
                <filter string="Costo Alto (&gt;100)" name="high_cost" 
                        domain="[('product_cost', '&gt;', 100)]"/>
                <filter string="Costo Medio (10-100)" name="medium_cost" 
                        domain="[('product_cost', '&gt;=', 10), ('product_cost', '&lt;=', 100)]"/>
                <filter string="Costo Bajo (&lt;10)" name="low_cost" 
                        domain="[('product_cost', '&lt;', 10)]"/>
                
                <group expand="0" string="Agrupar por">
                    <filter string="Rango de Costo" name="group_by_cost_range" 
                            context="{'group_by': 'product_cost'}"/>
                </group>
            </xpath>
            
        </field>
    </record>

</odoo>
